<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N2Shop - DeepSeek AI Vision</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase v9+ modular SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, deleteDoc, doc, updateDoc, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadString, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        window.firebaseModules = {
            initializeApp,
            getFirestore,
            collection,
            addDoc,
            deleteDoc,
            doc,
            updateDoc,
            query,
            orderBy,
            onSnapshot,
            getStorage,
            ref,
            uploadString,
            getDownloadURL
        };
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // ============================================
        // FIREBASE CONFIG
        // ============================================
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyA-legWlCgjMDEy70rsaTTwLK39F4ZCKhM",
            authDomain: "n2shop-69e37.firebaseapp.com",
            databaseURL: "https://n2shop-69e37-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "n2shop-69e37",
            storageBucket: "n2shop-69e37.appspot.com",
            messagingSenderId: "598906493303",
            appId: "1:598906493303:web:46d6236a1fdc2eff33e972",
            measurementId: "G-TEJH3S2T1D"
        };

        // ============================================
        // DEEPSEEK API KEY
        // L·∫•y t·∫°i: https://platform.deepseek.com/api_keys
        // ============================================
        const DEEPSEEK_API_KEY = "YOUR_DEEPSEEK_API_KEY_HERE"; // ‚Üê THAY B·∫∞NG KEY C·ª¶A B·∫†N

        function ClothingNamingApp() {
            const [products, setProducts] = useState([]);
            const [currentImage, setCurrentImage] = useState(null);
            const [suggestedName, setSuggestedName] = useState('');
            const [editedName, setEditedName] = useState('');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [showCamera, setShowCamera] = useState(false);
            const [stream, setStream] = useState(null);
            const [firebaseApp, setFirebaseApp] = useState(null);
            const [db, setDb] = useState(null);
            const [storage, setStorage] = useState(null);
            const [isOnline, setIsOnline] = useState(true);
            const [isSyncing, setIsSyncing] = useState(false);
            const [lastSync, setLastSync] = useState(null);
            const [unsubscribe, setUnsubscribe] = useState(null);
            const [showApiSetup, setShowApiSetup] = useState(false);
            const [deepseekKey, setDeepseekKey] = useState('');

            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const fileInputRef = useRef(null);

            useEffect(() => {
                const handleOnline = () => setIsOnline(true);
                const handleOffline = () => setIsOnline(false);

                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);

                // Load saved DeepSeek API key
                const savedKey = localStorage.getItem('deepseek_api_key');
                if (savedKey) {
                    setDeepseekKey(savedKey);
                } else if (DEEPSEEK_API_KEY !== "YOUR_DEEPSEEK_API_KEY_HERE") {
                    setDeepseekKey(DEEPSEEK_API_KEY);
                    localStorage.setItem('deepseek_api_key', DEEPSEEK_API_KEY);
                }

                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);

            useEffect(() => {
                initFirebase(FIREBASE_CONFIG);
                return () => {
                    if (unsubscribe) {
                        unsubscribe();
                    }
                };
            }, []);

            const initFirebase = async (config) => {
                try {
                    const { initializeApp, getFirestore, getStorage, collection, query, orderBy, onSnapshot } = window.firebaseModules;

                    const app = initializeApp(config);
                    const firestoreDb = getFirestore(app);
                    const firebaseStorage = getStorage(app);

                    setFirebaseApp(app);
                    setDb(firestoreDb);
                    setStorage(firebaseStorage);

                    const productsRef = collection(firestoreDb, 'clothing_products');
                    const q = query(productsRef, orderBy('createdAt', 'desc'));

                    const unsub = onSnapshot(q, (snapshot) => {
                        const productsData = [];
                        snapshot.forEach((doc) => {
                            productsData.push({
                                id: doc.id,
                                ...doc.data()
                            });
                        });
                        setProducts(productsData);
                        localStorage.setItem('clothingProducts', JSON.stringify(productsData));
                        setLastSync(new Date());
                    }, (error) => {
                        console.error('Error listening to products:', error);
                        loadLocalProducts();
                    });

                    setUnsubscribe(() => unsub);
                } catch (error) {
                    console.error('Error initializing Firebase:', error);
                    loadLocalProducts();
                }
            };

            const loadLocalProducts = () => {
                const saved = localStorage.getItem('clothingProducts');
                if (saved) {
                    setProducts(JSON.parse(saved));
                }
            };

            const saveApiKey = () => {
                if (!deepseekKey.trim()) {
                    alert('Vui l√≤ng nh·∫≠p DeepSeek API Key');
                    return;
                }
                localStorage.setItem('deepseek_api_key', deepseekKey.trim());
                setShowApiSetup(false);
                alert('‚úÖ ƒê√£ l∆∞u API Key!');
            };

            const saveProductToFirebase = async (product) => {
                if (!db || !storage) {
                    const newProducts = [product, ...products];
                    setProducts(newProducts);
                    localStorage.setItem('clothingProducts', JSON.stringify(newProducts));
                    return;
                }

                try {
                    setIsSyncing(true);
                    const { collection, addDoc, ref, uploadString, getDownloadURL } = window.firebaseModules;

                    const imageRef = ref(storage, `products/${Date.now()}.jpg`);
                    await uploadString(imageRef, product.image, 'data_url');
                    const imageUrl = await getDownloadURL(imageRef);

                    await addDoc(collection(db, 'clothing_products'), {
                        name: product.name,
                        imageUrl: imageUrl,
                        createdAt: new Date()
                    });
                } catch (error) {
                    console.error('Error saving to Firebase:', error);
                    alert('‚ö†Ô∏è Kh√¥ng th·ªÉ l∆∞u v√†o cloud. ƒê√£ l∆∞u v√†o thi·∫øt b·ªã.');
                    const newProducts = [product, ...products];
                    setProducts(newProducts);
                    localStorage.setItem('clothingProducts', JSON.stringify(newProducts));
                } finally {
                    setIsSyncing(false);
                }
            };

            const deleteProductFromFirebase = async (id) => {
                if (!db) {
                    const newProducts = products.filter(p => p.id !== id);
                    setProducts(newProducts);
                    localStorage.setItem('clothingProducts', JSON.stringify(newProducts));
                    return;
                }

                try {
                    setIsSyncing(true);
                    const { doc, deleteDoc } = window.firebaseModules;
                    await deleteDoc(doc(db, 'clothing_products', id));
                } catch (error) {
                    console.error('Error deleting from Firebase:', error);
                    alert('‚ö†Ô∏è Kh√¥ng th·ªÉ x√≥a t·ª´ cloud.');
                } finally {
                    setIsSyncing(false);
                }
            };

            const updateProductInFirebase = async (id, newName) => {
                if (!db) {
                    const newProducts = products.map(p =>
                        p.id === id ? { ...p, name: newName } : p
                    );
                    setProducts(newProducts);
                    localStorage.setItem('clothingProducts', JSON.stringify(newProducts));
                    return;
                }

                try {
                    setIsSyncing(true);
                    const { doc, updateDoc } = window.firebaseModules;
                    await updateDoc(doc(db, 'clothing_products', id), {
                        name: newName
                    });
                } catch (error) {
                    console.error('Error updating in Firebase:', error);
                    alert('‚ö†Ô∏è Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr√™n cloud.');
                } finally {
                    setIsSyncing(false);
                }
            };

            const startCamera = async () => {
                try {
                    const mediaStream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: 'environment' }
                    });
                    setStream(mediaStream);
                    setShowCamera(true);
                    if (videoRef.current) {
                        videoRef.current.srcObject = mediaStream;
                    }
                } catch (err) {
                    alert('Kh√¥ng th·ªÉ truy c·∫≠p camera. Vui l√≤ng cho ph√©p quy·ªÅn camera ho·∫∑c ch·ªçn ·∫£nh t·ª´ th∆∞ vi·ªán.');
                }
            };

            const stopCamera = () => {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    setStream(null);
                }
                setShowCamera(false);
            };

            const capturePhoto = () => {
                const canvas = canvasRef.current;
                const video = videoRef.current;

                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);

                const imageData = canvas.toDataURL('image/jpeg', 0.8);
                setCurrentImage(imageData);
                stopCamera();
                analyzeImage(imageData);
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const imageData = event.target.result;
                        setCurrentImage(imageData);
                        analyzeImage(imageData);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const analyzeImage = async (imageData) => {
                const currentKey = deepseekKey || localStorage.getItem('deepseek_api_key');

                if (!currentKey || currentKey === "YOUR_DEEPSEEK_API_KEY_HERE") {
                    setShowApiSetup(true);
                    alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p DeepSeek API Key tr∆∞·ªõc!\n\nL·∫•y t·∫°i: https://platform.deepseek.com/api_keys\n\nüí∞ GI√Å C·ª∞C R·∫∫:\n- Input: $0.14/1M tokens\n- Output: $0.28/1M tokens\n- Free tier: 5M tokens ($8.40)');
                    return;
                }

                setIsAnalyzing(true);
                setSuggestedName('');

                try {
                    // Chu·∫©n b·ªã context t·ª´ s·∫£n ph·∫©m c≈©
                    let contextMessage = '';
                    if (products.length > 0) {
                        contextMessage = '\n\nD·ª±a v√†o c√°c s·∫£n ph·∫©m ƒë√£ ƒë·∫∑t t√™n tr∆∞·ªõc ƒë√≥ ƒë·ªÉ h·ªçc c√°ch ƒë·∫∑t t√™n:\n';
                        products.slice(-10).forEach(p => {
                            contextMessage += `- ${p.name}\n`;
                        });
                    }

                    const prompt = `B·∫°n l√† chuy√™n gia ph√¢n t√≠ch s·∫£n ph·∫©m qu·∫ßn √°o. H√£y ph√¢n t√≠ch h√¨nh ·∫£nh n√†y v√† ƒë·∫∑t t√™n s·∫£n ph·∫©m theo ƒë·ªãnh d·∫°ng vi·∫øt t·∫Øt c·ªßa Ti·∫øng Vi·ªát.

QUY T·∫ÆC ƒê·∫∂T T√äN:
- S·ª≠ d·ª•ng vi·∫øt t·∫Øt: √ÅO (√°o), Q. (qu·∫ßn), ƒê·∫¶M (ƒë·∫ßm), SET (b·ªô)
- M√¥ t·∫£ ki·ªÉu d√°ng: C·ªî TIM (c·ªï tim), TD (tay d√†i), BI (ch·∫•m bi), S·ªåC (s·ªçc), SU√îNG (su√¥ng)
- M√†u s·∫Øc: TR·∫ÆNG, ƒêEN, XANH, ƒê·ªé, V√ÄNG, CAM, H·ªíNG...
- Th∆∞∆°ng hi·ªáu n·∫øu c√≥: ALO, BBR (Burberry), MM (Mickey Mouse)...

V√ç D·ª§:
- "SET √ÅO C·ªî TIM + Q.SU√îNG S·ªåC ALO" - b·ªô √°o c·ªï tim v√† qu·∫ßn su√¥ng s·ªçc th∆∞∆°ng hi·ªáu Alo
- "SET √ÅO TD MM + Q.D√ÄI BI" - b·ªô √°o tay d√†i Mickey Mouse v√† qu·∫ßn d√†i ch·∫•m bi
- "ƒê·∫¶M SMI BBR K√àM BELT N√ÇU" - ƒë·∫ßm su√¥ng mi Burberry k√®m belt m√†u n√¢u
${contextMessage}

H√£y ph√¢n t√≠ch h√¨nh ·∫£nh v√† ƒë·ªÅ xu·∫•t T√äN DUY NH·∫§T theo format tr√™n. CH·ªà TR·∫¢ V·ªÄ T√äN S·∫¢N PH·∫®M, KH√îNG GI·∫¢I TH√çCH.`;

                    // Convert base64 to DeepSeek format
                    const base64Data = imageData.split(',')[1];

                    const response = await fetch(
                        'https://api.deepseek.com/v1/chat/completions',
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${currentKey}`
                            },
                            body: JSON.stringify({
                                model: "deepseek-chat",
                                messages: [{
                                    role: "user",
                                    content: [
                                        {
                                            type: "text",
                                            text: prompt
                                        },
                                        {
                                            type: "image_url",
                                            image_url: {
                                                url: `data:image/jpeg;base64,${base64Data}`
                                            }
                                        }
                                    ]
                                }],
                                temperature: 0.7,
                                max_tokens: 150
                            })
                        }
                    );

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('DeepSeek API error:', errorData);

                        if (response.status === 401) {
                            alert('‚ùå API Key kh√¥ng h·ª£p l·ªá!\n\nVui l√≤ng:\n1. Ki·ªÉm tra l·∫°i key\n2. L·∫•y key m·ªõi t·∫°i: https://platform.deepseek.com/api_keys');
                            setShowApiSetup(true);
                        } else if (response.status === 400) {
                            alert('‚ö†Ô∏è L·ªói request. Ki·ªÉm tra:\n1. API Key c√≥ ƒë√∫ng\n2. Format ·∫£nh (JPEG/PNG)\n3. K√≠ch th∆∞·ªõc ·∫£nh kh√¥ng qu√° l·ªõn');
                        } else if (response.status === 429) {
                            alert('‚è≥ V∆∞·ª£t qu√° gi·ªõi h·∫°n rate limit.\nVui l√≤ng ƒë·ª£i m·ªôt ch√∫t r·ªìi th·ª≠ l·∫°i.');
                        } else {
                            throw new Error(`API error: ${response.status}`);
                        }
                        return;
                    }

                    const data = await response.json();

                    if (data.choices && data.choices[0]?.message?.content) {
                        const name = data.choices[0].message.content.trim();
                        setSuggestedName(name);
                        setEditedName(name);
                    } else {
                        throw new Error('Invalid response format');
                    }
                } catch (error) {
                    console.error("Error analyzing image:", error);
                    alert('‚ùå C√≥ l·ªói x·∫£y ra khi ph√¢n t√≠ch h√¨nh ·∫£nh.\n\nKi·ªÉm tra:\n1. K·∫øt n·ªëi internet\n2. API Key c√≥ ƒë√∫ng kh√¥ng\n3. Quota c√≤n kh√¥ng');
                } finally {
                    setIsAnalyzing(false);
                }
            };

            const saveProduct = () => {
                if (!editedName.trim()) {
                    alert('Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m');
                    return;
                }

                const newProduct = {
                    name: editedName.trim(),
                    image: currentImage,
                    createdAt: new Date()
                };

                saveProductToFirebase(newProduct);
                setCurrentImage(null);
                setSuggestedName('');
                setEditedName('');
            };

            const deleteProduct = (id) => {
                if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')) {
                    deleteProductFromFirebase(id);
                }
            };

            const editProduct = (id) => {
                const product = products.find(p => p.id === id);
                const newName = prompt('Nh·∫≠p t√™n m·ªõi:', product.name);
                if (newName && newName.trim()) {
                    updateProductInFirebase(id, newName.trim());
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-50 to-violet-100 p-4">
                    <div className="max-w-4xl mx-auto">
                        {/* API Setup Modal */}
                        {showApiSetup && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-lg w-full">
                                    <h2 className="text-2xl font-bold text-purple-600 mb-4">
                                        üîë Setup DeepSeek API
                                    </h2>

                                    <div className="mb-4">
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                                            DeepSeek API Key:
                                        </label>
                                        <input
                                            type="text"
                                            value={deepseekKey}
                                            onChange={(e) => setDeepseekKey(e.target.value)}
                                            placeholder="sk-..."
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none font-mono text-sm"
                                        />
                                    </div>

                                    <div className="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4">
                                        <p className="text-sm font-semibold text-gray-700 mb-2">
                                            üìù C√°ch l·∫•y API Key (2 ph√∫t):
                                        </p>
                                        <ol className="text-xs text-gray-600 space-y-1 list-decimal list-inside">
                                            <li>V√†o: <a href="https://platform.deepseek.com/api_keys" target="_blank" className="text-purple-600 underline">platform.deepseek.com</a></li>
                                            <li>ƒêƒÉng k√Ω/ƒêƒÉng nh·∫≠p t√†i kho·∫£n</li>
                                            <li>Click "Create API Key"</li>
                                            <li>Copy key v√† paste v√†o ƒë√¢y</li>
                                        </ol>
                                        <div className="mt-3 pt-3 border-t border-purple-200">
                                            <p className="text-xs font-semibold text-purple-700">üí∞ GI√Å C·ª∞C R·∫∫:</p>
                                            <ul className="text-xs text-gray-600 space-y-1 mt-1">
                                                <li>‚Ä¢ Free tier: <span className="font-semibold text-green-600">5M tokens ($8.40)</span></li>
                                                <li>‚Ä¢ Input: $0.14/1M tokens (r·∫ª h∆°n 50x GPT-4)</li>
                                                <li>‚Ä¢ Output: $0.28/1M tokens</li>
                                                <li>‚Ä¢ Vision: H·ªó tr·ª£ ·∫£nh base64/URL</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            onClick={saveApiKey}
                                            className="flex-1 bg-purple-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-purple-700 transition-colors"
                                        >
                                            ‚úÖ L∆∞u Key
                                        </button>
                                        <button
                                            onClick={() => setShowApiSetup(false)}
                                            className="flex-1 bg-gray-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-gray-700 transition-colors"
                                        >
                                            ‚ùå ƒê√≥ng
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Header */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <div className="flex justify-between items-start mb-2">
                                <div>
                                    <h1 className="text-3xl font-bold text-purple-600 mb-2">
                                        üè∑Ô∏è N2Shop - DeepSeek AI Vision
                                    </h1>
                                    <p className="text-gray-600">
                                        Powered by DeepSeek (R·∫∫ NH·∫§T th·ªã tr∆∞·ªùng) üíé
                                    </p>
                                </div>
                                <div className="text-right space-y-2">
                                    {db && (
                                        <div className="flex items-center gap-2 text-orange-600 text-sm font-semibold">
                                            <span className="w-2 h-2 bg-orange-500 rounded-full animate-pulse"></span>
                                            <span>üî• Firebase</span>
                                        </div>
                                    )}
                                    {deepseekKey && deepseekKey !== "YOUR_DEEPSEEK_API_KEY_HERE" ? (
                                        <div className="flex items-center gap-2 text-green-600 text-sm font-semibold">
                                            <span>‚úÖ DeepSeek Ready</span>
                                        </div>
                                    ) : (
                                        <button
                                            onClick={() => setShowApiSetup(true)}
                                            className="text-sm bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700"
                                        >
                                            üîë Setup API
                                        </button>
                                    )}
                                    {deepseekKey && (
                                        <button
                                            onClick={() => setShowApiSetup(true)}
                                            className="text-xs text-gray-500 hover:text-gray-700 block"
                                        >
                                            ƒê·ªïi API Key
                                        </button>
                                    )}
                                </div>
                            </div>

                            <div className="flex items-center gap-3 mt-4">
                                <div className={`flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold ${
                                    isOnline ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'
                                }`}>
                                    <span className={`w-2 h-2 rounded-full ${isOnline ? 'bg-green-500' : 'bg-red-500'}`}></span>
                                    <span>{isOnline ? 'Online' : 'Offline'}</span>
                                </div>

                                <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-purple-100 text-purple-700 text-xs font-semibold">
                                    <span>üíé DeepSeek Vision AI</span>
                                </div>

                                {isSyncing && (
                                    <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-orange-100 text-orange-700 text-xs font-semibold">
                                        <svg className="animate-spin h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        <span>ƒêang l∆∞u...</span>
                                    </div>
                                )}
                            </div>
                        </div>

                        {!currentImage && !showCamera && (
                            <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                                <div className="flex flex-col sm:flex-row gap-4">
                                    <button
                                        onClick={startCamera}
                                        className="flex-1 bg-purple-600 text-white py-4 px-6 rounded-xl font-semibold hover:bg-purple-700 transition-colors flex items-center justify-center gap-2"
                                    >
                                        <span>üì∏</span>
                                        <span>Ch·ª•p ·∫¢nh</span>
                                    </button>
                                    <button
                                        onClick={() => fileInputRef.current?.click()}
                                        className="flex-1 bg-green-600 text-white py-4 px-6 rounded-xl font-semibold hover:bg-green-700 transition-colors flex items-center justify-center gap-2"
                                    >
                                        <span>üñºÔ∏è</span>
                                        <span>Ch·ªçn T·ª´ Th∆∞ Vi·ªán</span>
                                    </button>
                                    <input
                                        ref={fileInputRef}
                                        type="file"
                                        accept="image/*"
                                        onChange={handleFileUpload}
                                        className="hidden"
                                    />
                                </div>
                            </div>
                        )}

                        {showCamera && (
                            <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                                <video
                                    ref={videoRef}
                                    autoPlay
                                    playsInline
                                    className="w-full rounded-lg mb-4"
                                />
                                <canvas ref={canvasRef} className="hidden" />
                                <div className="flex gap-4">
                                    <button
                                        onClick={capturePhoto}
                                        className="flex-1 bg-purple-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-purple-700 transition-colors"
                                    >
                                        üì∏ Ch·ª•p
                                    </button>
                                    <button
                                        onClick={stopCamera}
                                        className="flex-1 bg-gray-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-gray-700 transition-colors"
                                    >
                                        ‚ùå H·ªßy
                                    </button>
                                </div>
                            </div>
                        )}

                        {currentImage && (
                            <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">üìù ƒê·∫∑t T√™n S·∫£n Ph·∫©m</h2>

                                <img
                                    src={currentImage}
                                    alt="Product"
                                    className="w-full max-h-96 object-contain rounded-lg mb-4 border-2 border-gray-200"
                                />

                                {isAnalyzing ? (
                                    <div className="text-center py-8">
                                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
                                        <p className="text-gray-600">üíé DeepSeek ƒëang ph√¢n t√≠ch...</p>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                T√™n ƒê·ªÅ Xu·∫•t (DeepSeek AI):
                                            </label>
                                            <div className="bg-purple-50 p-4 rounded-lg text-purple-900 font-semibold">
                                                {suggestedName || 'ƒêang ch·ªù ph√¢n t√≠ch...'}
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Ch·ªânh S·ª≠a T√™n:
                                            </label>
                                            <input
                                                type="text"
                                                value={editedName}
                                                onChange={(e) => setEditedName(e.target.value)}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
                                                placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..."
                                            />
                                        </div>

                                        <div className="flex gap-4">
                                            <button
                                                onClick={saveProduct}
                                                disabled={!editedName.trim() || isSyncing}
                                                className="flex-1 bg-green-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-green-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                                            >
                                                ‚úÖ L∆∞u S·∫£n Ph·∫©m
                                            </button>
                                            <button
                                                onClick={() => {
                                                    setCurrentImage(null);
                                                    setSuggestedName('');
                                                    setEditedName('');
                                                }}
                                                className="flex-1 bg-gray-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-gray-700 transition-colors"
                                            >
                                                üîÑ Ch·ª•p L·∫°i
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        <div className="bg-white rounded-2xl shadow-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-xl font-bold text-gray-800">
                                    üì¶ S·∫£n Ph·∫©m ({products.length})
                                </h2>
                            </div>

                            {products.length === 0 ? (
                                <div className="text-center py-12 text-gray-500">
                                    <p className="text-lg mb-2">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</p>
                                    <p className="text-sm">Ch·ª•p ·∫£nh ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
                                </div>
                            ) : (
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    {products.map((product) => (
                                        <div key={product.id} className="border-2 border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow">
                                            <img
                                                src={product.imageUrl || product.image}
                                                alt={product.name}
                                                className="w-full h-48 object-cover"
                                            />
                                            <div className="p-4">
                                                <h3 className="font-bold text-gray-800 mb-2 text-sm">
                                                    {product.name}
                                                </h3>
                                                <p className="text-xs text-gray-500 mb-3">
                                                    {product.createdAt ? new Date(product.createdAt.seconds * 1000).toLocaleString('vi-VN') : 'N/A'}
                                                </p>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => editProduct(product.id)}
                                                        disabled={isSyncing}
                                                        className="flex-1 bg-blue-500 text-white py-2 px-3 rounded-lg text-sm font-semibold hover:bg-blue-600 transition-colors disabled:bg-gray-300"
                                                    >
                                                        ‚úèÔ∏è S·ª≠a
                                                    </button>
                                                    <button
                                                        onClick={() => deleteProduct(product.id)}
                                                        disabled={isSyncing}
                                                        className="flex-1 bg-red-500 text-white py-2 px-3 rounded-lg text-sm font-semibold hover:bg-red-600 transition-colors disabled:bg-gray-300"
                                                    >
                                                        üóëÔ∏è X√≥a
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        <div className="mt-6 bg-purple-50 rounded-xl p-4 text-sm text-gray-700">
                            <p className="font-semibold mb-2">
                                üíé DeepSeek Vision AI - R·∫∫ NH·∫§T TH·ªä TR∆Ø·ªúNG
                            </p>
                            <ul className="list-disc list-inside space-y-1 text-xs">
                                <li>‚úÖ Free tier: <span className="font-semibold text-green-600">5M tokens ($8.40)</span></li>
                                <li>‚úÖ R·∫ª h∆°n GPT-4 g·∫•p <span className="font-semibold text-purple-600">50 l·∫ßn</span> ($0.14 vs $7.5/1M)</li>
                                <li>‚úÖ Nh·∫≠n di·ªán h√¨nh ·∫£nh ch√≠nh x√°c cao</li>
                                <li>‚úÖ H·ªçc t·ª´ s·∫£n ph·∫©m c≈©</li>
                                <li>‚úÖ H·ªó tr·ª£ base64 & URL image</li>
                                <li>‚úÖ OpenAI-compatible API</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<ClothingNamingApp />, document.getElementById('root'));
    </script>
</body>
</html>
